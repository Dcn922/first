//题目内容：
//NMEA-0183协议是为了在不同的GPS（全球定位系统）导航设备中建立统一的BTCM（海事无线电技术委员会）标准，
//NMEA-0183协议定义的语句非常多，但是常用的或者说兼容性最广的语句只有$GPGGA、$GPGSA、$GPGSV、$GPRMC、$GPVTG、$GPGLL等。

//其中$GPRMC语句的格式如下：
//    $GPRMC,024813.640,A,3158.4608,N,11848.3737,E,10.05,324.27,150706,,,A*50
//这里整条语句是一个文本行，行中以逗号“,”隔开各个字段，每个字段的大小（长度）不一
//(这里的示例只是一种可能，并不能认为字段的大小就如上述例句一样。)

//字段0：$GPRMC，语句ID，表明该语句为Recommended Minimum Specific GPS/TRANSIT Data（RMC）推荐最小定位信息
//字段1：UTC时间，hhmmss.sss格式
//字段2：状态，A=定位，V=未定位
//字段3：纬度ddmm.mmmm，度分格式（前导位数不足则补0）
//字段4：纬度N（北纬）或S（南纬）
//字段5：经度dddmm.mmmm，度分格式（前导位数不足则补0）
//字段6：经度E（东经）或W（西经）
//字段7：速度，节，Knots
//字段8：方位角，度
//字段9：UTC日期，DDMMYY格式
//字段10：磁偏角，（000 - 180）度（前导位数不足则补0）
//字段11：磁偏角方向，E=东W=西
//字段16：校验值

//这里，“*”为校验和识别符，其后面的两位数为校验和，代表了“$”和“*”之间所有字符（不包括这两个字符）的异或值的十六进制值。
//上面这条例句的校验和是十六进制的50，也就是十进制的80。

//提示：^运算符的作用是异或。将$和*之间所有的字符做^运算(第一个字符和第二个字符异或，结果再和第三个字符异或，
//依此类推)之后的值对65536取余后的结果，应该和*后面的两个十六进制数字的值相等，否则的话说明这条语句在传输中发生了错误。
//注意这个十六进制值中是会出现A-F的大写字母的。

//现在，你的程序要读入一系列GPS输出，其中包含$GPRMC，也包含其他语句。在数据的最后，有一行单独的
//    END
//表示数据的结束。

//你的程序要从中找出$GPRMC语句，计算校验和，找出其中校验正确，并且字段2表示已定位的语句(若为未定位校验值会出错)，从中计算出时间，换算成北京时间。
//一次数据中会包含多条$GPRMC语句，以最后一条语句得到的北京时间作为结果输出。(你的程序一定会读到一条有效的$GPRMC语句)

//输入格式:
//多条GPS语句，每条均以回车换行结束。最后一行是END三个大写字母。

//输出格式：
//6位数时间，表达为：
//hh:mm:ss
//其中，hh是两位数的小时，不足两位时前面补0；mm是两位数的分钟，不足两位时前面补0；ss是两位数的秒，不足两位时前面补0。
//UTC时间相当于BJT减去8。

//输入样例：
//$GPRMC,024813.640,A,3158.4608,N,11848.3737,E,10.05,324.27,150706,,,A*50
//$GPRMC,024813.640,V,3158.4608,N,11848.3737,E,10.05,324.27,150706,,,A*50
//END

//输出样例：
//10:48:13

#include<stdio.h>
#include<string.h>
main()
{
    char str[100] = "\0";
    char str1[] = "END";
    char str2[] = "$GPRMC";
 
    int jiaoyan1;
    char jiaoyan2[2];
    int jiaoyan3;
    int jiaoyan4;
 
    int i,j,len;
    int hh,mm,ss;
 
    do
    {
        gets(str);
        if (strncmp(str, str2, 6) == 0)//如果字符串的前6位是$GPRMC
        {
        	jiaoyan1 = str[1];
            for (i = 2; str[i] != '*'; i++)
            {
                jiaoyan1 = jiaoyan1^str[i];
            }
            jiaoyan3 = jiaoyan1 % 65536;//完成效验的提示
            len = strlen(str);//求出字符串长度
            for (i = len - 2, j = 0; j < 2; i++, j++)//取出*后面的两个十六进制数字的值
            {
                jiaoyan2[j] = str[i];
            }
            sscanf(jiaoyan2, "%x", &jiaoyan4);//%x以十六进制格式输入整型数
            if (jiaoyan3 == jiaoyan4)//校验正确
            {
                sscanf(str, "$GPRMC,%2d %2d %2d", &hh, &mm, &ss);
            }
        }
    } while (strcmp(str, str1) != 0);//循环，当输入的字符串不是END，继续循环
    hh = hh + 8;//北京时间
    if (hh >= 24)//如果大于24小时
    {
        hh = hh - 24;
    }
    printf("%02d:%02d:%02d", hh, mm, ss);
    return 0;
}
